<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html ng-app="cylon">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="description">
    <meta content="Andrew Stewart" name="author">
    <title>Functional Robots With Wisp</title>
    <link href="/stylesheets/application.css" rel="stylesheet">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="/javascripts/plax.js"></script>
    <script src="/javascripts/parallax_bottom.js"></script>
    <script src="/javascripts/vendor/angular.min.js"></script>
    <script src="/javascripts/app.js"></script>
    <link href="//fonts.googleapis.com/css?family=Inconsolata:400,700%7CMontserrat:700" rel="stylesheet">
    <link href="/favicon.ico" rel="shortcut icon" type="image/gif">
  <script type="text/javascript">


  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46433484-2', {"cookieDomain":"cylonjs.com"});
















   ga('send', 'pageview');


</script></head>
  <body>
    
    <div class="app-header section-nav" id="top" role="banner">
      <div class="container">
        <div class="display">
          <div class="app-logo">
            <a href="/">Cylon</a>
          </div>
        </div>
        <nav class="menu">
          <ul class="nav-list">
            <li>
              <a href="/documentation" class="item">Docs</a>
            </li>
            <li>
              <a href="/documentation/platforms" class="item">Platforms</a>
            </li>
            <li>
              <a href="/resources" class="item">Resources</a>
            </li>
            <li>
              <a class="active" href="/blog">Blog</a>
            </li>
            <li>
              <a class="item" target="_blank" href="https://github.com/hybridgroup/cylon/">Github</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
    <div class="app-content">
      <div class="page-title">
        <div class="container">
          <h1 class="title">Blog</h1>
        </div>
      </div>
      
      <div class="main-content blog" role="main">
        <div class="articles">
          <header class="header">
            <div class="dates">
              <div class="date-top">
                <div class="month">
                  Apr
                </div>
                <div class="day">
                  02
                </div>
              </div>
              <div class="date-bottom">
                <div class="year">
                  2014
                </div>
              </div>
            </div>
            <h3 class="article-title">
              <a href="/blog/2014/04/02/functional-robots-with-wisp/">Functional Robots With Wisp</a>
              <br>
            </h3>
            <div class="author">
              by Andrew Stewart
            </div>
          </header>
          <p><a href="https://github.com/Gozala/wisp">Wisp</a> is a really cool project for compiling a subset of Clojure syntax to
          JavaScript, without having to go through all the hoops that <a href="https://github.com/clojure/clojurescript">ClojureScript</a>
          forces you through.</p>
          
          <p>Wisp also compiles to plain JavaScript, without setting up a number of data
          structures and language idioms the way ClojureScript or other [lang]-to-JS
          compilers sometimes do. This lets you write Clojure with a fairly good idea of
          how it'll map to the resulting JavaScript.</p>
          
          <p>For an example, I decided to convert the <a href="https://cylonjs.com">Cylon.JS</a> <a href="http://cylonjs.com/documentation/examples/cylon/js/cattoy/">cat toy</a> example to it,
          just to get a feel for the process.</p>
          
          <p>The example robot I'm converting hooks up to a Digispark with a couple servos
          and a Leap Motion. The robot uses hand positions picked up by the Leap Motion
          to control the servos. Simple enough.</p>
          
          <p>It's pretty straight-forward JavaScript, so it shouldn't be too hard to convert.
          Now let's write an analogue in Clojure.</p>
          
          <pre class="CodeRay">(<span class="keyword">def</span> <span class="function">Cylon</span> (<span class="keyword">require</span> <span class="string"><span class="delimiter">"</span><span class="content">cylon</span><span class="delimiter">"</span></span>))

<span class="comment">; We're re-writing how the -&gt; special form works here to allow for method</span>
<span class="comment">; chaining later on.</span>
(<span class="keyword">defmacro</span> <span class="function">-&gt;</span>
  [&amp; operations]
  (<span class="keyword">reduce</span>
  (<span class="keyword">fn</span> [form operation]
    (<span class="keyword">cons</span> (<span class="keyword">first</span> operation)
          (<span class="keyword">cons</span> form (<span class="keyword">rest</span> operation))))
  (<span class="keyword">first</span> operations)
  (<span class="keyword">rest</span> operations)))

(<span class="keyword">def</span> <span class="function">robot</span> {
  connections [
    { <span class="symbol">:name</span> <span class="string"><span class="delimiter">"</span><span class="content">digispark</span><span class="delimiter">"</span></span> <span class="symbol">:adaptor</span> <span class="string"><span class="delimiter">"</span><span class="content">digispark</span><span class="delimiter">"</span></span> }
    { <span class="symbol">:name</span> <span class="string"><span class="delimiter">"</span><span class="content">leapmotion</span><span class="delimiter">"</span></span> <span class="symbol">:adaptor</span> <span class="string"><span class="delimiter">"</span><span class="content">leapmotion</span><span class="delimiter">"</span></span> <span class="symbol">:port</span> <span class="string"><span class="delimiter">"</span><span class="content">127.0.0.1:6437</span><span class="delimiter">"</span></span> }]

  devices [
    { <span class="symbol">:name</span> <span class="string"><span class="delimiter">"</span><span class="content">servo1</span><span class="delimiter">"</span></span> <span class="symbol">:driver</span> <span class="string"><span class="delimiter">"</span><span class="content">servo</span><span class="delimiter">"</span></span> <span class="symbol">:pin</span> <span class="integer">0</span> <span class="symbol">:connection</span> <span class="string"><span class="delimiter">"</span><span class="content">digispark</span><span class="delimiter">"</span></span> }
    { <span class="symbol">:name</span> <span class="string"><span class="delimiter">"</span><span class="content">servo2</span><span class="delimiter">"</span></span> <span class="symbol">:driver</span> <span class="string"><span class="delimiter">"</span><span class="content">servo</span><span class="delimiter">"</span></span> <span class="symbol">:pin</span> <span class="integer">1</span> <span class="symbol">:connection</span> <span class="string"><span class="delimiter">"</span><span class="content">digispark</span><span class="delimiter">"</span></span> }
    { <span class="symbol">:name</span> <span class="string"><span class="delimiter">"</span><span class="content">leapmotion</span><span class="delimiter">"</span></span> <span class="symbol">:driver</span> <span class="string"><span class="delimiter">"</span><span class="content">leapmotion</span><span class="delimiter">"</span></span> <span class="symbol">:connection</span> <span class="string"><span class="delimiter">"</span><span class="content">leapmotion</span><span class="delimiter">"</span></span> }]

  work (<span class="keyword">fn</span> [my]
    (<span class="keyword">let</span> [x <span class="integer">90</span>
          z <span class="integer">90</span>]
      (my.leapmotion.on
        <span class="symbol">:hand</span>
        (<span class="keyword">fn</span> [hand]
          <span class="comment">; wisp gives us this set! form to let us change variables,</span>
          <span class="comment">; and also using the redefined -&gt; macro we wrote earlier</span>
          (set! x (<span class="keyword">-&gt;</span> hand.palmX (<span class="keyword">.</span>fromScale <span class="integer">-300</span> <span class="integer">300</span>) (<span class="keyword">.</span>toScale <span class="integer">30</span> <span class="integer">150</span>)))
          (set! y (<span class="keyword">-&gt;</span> hand.palmY (<span class="keyword">.</span>fromScale <span class="integer">-300</span> <span class="integer">300</span>) (<span class="keyword">.</span>toScale <span class="integer">30</span> <span class="integer">150</span>)))))

      (every
        <span class="integer">100</span>
        (<span class="keyword">fn</span> []
          (my.servo1.angle x)
          (my.servo2.angle z)
          (console.log
            <span class="string"><span class="delimiter">"</span><span class="content">Current Angle:</span><span class="delimiter">"</span></span>
            (my.servo1.currentAngle)
            <span class="string"><span class="delimiter">"</span><span class="content">,</span><span class="delimiter">"</span></span>
            (my.servo2.currentAngle))))))})

(<span class="keyword">.</span>start (Cylon.Robot robot))
</pre>
          
          <p>It still looks a fair bit like the original example, but it's clear we're not in
          Kansas anymore. We even had to write a macro to get method chaining working
          properly, but that's another cool thing: we wrote a macro, and it works.</p>
          
          <p>The <code>wisp</code> binary has a couple modes; it can run files directly (<code>wisp
robot.wisp</code>), or will print a compiled version of code passed to <code>STDIN</code>.</p>
          
          <p>Running this with <code>cat robot.wisp | wisp &gt; robot.js</code>, we get a fairly decent
          approximation of the original, which even comes with a generated sourcemap to
          help with debugging.</p>
          
          <pre class="CodeRay"><span class="keyword">var</span> Cylon = exports.Cylon = require(<span class="string"><span class="delimiter">'</span><span class="content">cylon</span><span class="delimiter">'</span></span>);
<span class="keyword">void</span> <span class="integer">0</span>;
<span class="keyword">var</span> robot = exports.robot = {
        <span class="key">connections</span>: [
            {
                <span class="key"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">digispark</span><span class="delimiter">'</span></span>,
                <span class="key"><span class="delimiter">'</span><span class="content">adaptor</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">digispark</span><span class="delimiter">'</span></span>
            },
            {
                <span class="key"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">leapmotion</span><span class="delimiter">'</span></span>,
                <span class="key"><span class="delimiter">'</span><span class="content">adaptor</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">leapmotion</span><span class="delimiter">'</span></span>,
                <span class="key"><span class="delimiter">'</span><span class="content">port</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">127.0.0.1:6437</span><span class="delimiter">'</span></span>
            }
        ],
        <span class="key">devices</span>: [
            {
                <span class="key"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">servo1</span><span class="delimiter">'</span></span>,
                <span class="key"><span class="delimiter">'</span><span class="content">driver</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">servo</span><span class="delimiter">'</span></span>,
                <span class="key"><span class="delimiter">'</span><span class="content">pin</span><span class="delimiter">'</span></span>: <span class="integer">0</span>,
                <span class="key"><span class="delimiter">'</span><span class="content">connection</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">digispark</span><span class="delimiter">'</span></span>
            },
            {
                <span class="key"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">servo2</span><span class="delimiter">'</span></span>,
                <span class="key"><span class="delimiter">'</span><span class="content">driver</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">servo</span><span class="delimiter">'</span></span>,
                <span class="key"><span class="delimiter">'</span><span class="content">pin</span><span class="delimiter">'</span></span>: <span class="integer">1</span>,
                <span class="key"><span class="delimiter">'</span><span class="content">connection</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">digispark</span><span class="delimiter">'</span></span>
            },
            {
                <span class="key"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">leapmotion</span><span class="delimiter">'</span></span>,
                <span class="key"><span class="delimiter">'</span><span class="content">driver</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">leapmotion</span><span class="delimiter">'</span></span>,
                <span class="key"><span class="delimiter">'</span><span class="content">connection</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">leapmotion</span><span class="delimiter">'</span></span>
            }
        ],
        <span class="function">work</span>: <span class="keyword">function</span> (my) {
            <span class="keyword">return</span> <span class="keyword">function</span> () {
                <span class="keyword">var</span> x<span class="error">ø</span><span class="integer">1</span> = <span class="integer">90</span>;
                <span class="keyword">var</span> z<span class="error">ø</span><span class="integer">1</span> = <span class="integer">90</span>;
                my.leapmotion.on(<span class="string"><span class="delimiter">'</span><span class="content">hand</span><span class="delimiter">'</span></span>, <span class="keyword">function</span> (hand) {
                    x<span class="error">ø</span><span class="integer">1</span> = hand.palmX.fromScale(-<span class="integer">300</span>, <span class="integer">300</span>).toScale(<span class="integer">30</span>, <span class="integer">150</span>);
                    <span class="keyword">return</span> z<span class="error">ø</span><span class="integer">1</span> = hand.palmY.fromScale(-<span class="integer">300</span>, <span class="integer">300</span>).toScale(<span class="integer">30</span>, <span class="integer">150</span>);
                });
                <span class="keyword">return</span> every(<span class="integer">100</span>, <span class="keyword">function</span> () {
                    my.servo1.angle(x<span class="error">ø</span><span class="integer">1</span>);
                    my.servo2.angle(z<span class="error">ø</span><span class="integer">1</span>);
                    <span class="keyword">return</span> console.log(<span class="string"><span class="delimiter">'</span><span class="content">Current Angle:</span><span class="delimiter">'</span></span>, my.servo1.currentAngle(), <span class="string"><span class="delimiter">'</span><span class="content">,</span><span class="delimiter">'</span></span>, my.servo2.currentAngle());
                });
            }.call(<span class="local-variable">this</span>);
        }
    };
Cylon.Robot(robot).start();
<span class="comment">// [source map removed for formatting reasons]</span>
</pre>
          
          <p>I don't know if it's something I'd use in day-to-day yet, but Wisp seems like
          a really cool project for trying out some functional programming ideas in
          JavaScript.</p>
          
          <p>I also think this could be a great learning tool for people who want to learn
          Clojure without getting a full JVM set up. It's easy enough to setup (installs
          through NPM), and generates clear results in a familiar language, allowing users
          to clearly see what their Clojure source is doing.</p>
          <div class="blog-footer">
            <h2>Contact Us</h2>
            <ul>
              <li>
              Get involved with Cylon.js projects, ask questions, or stay up to date with the latest Cylon.js news on our
              <a target="blank" href="https://groups.google.com/forum/#!forum/cylonjs">mailing list!</a>
              <li>Need to some help? Talk to us on IRC: #cylon @ freenode.net</li>
              <li>
              If you need help or you feel we can improve something, let us know! Open a
              <a target="blank" href="https://github.com/hybridgroup/cylon/issues/new">new issue.</a>
              <li>
              To subscribe to announcements of releases and important changes, please follow
              <a target="blank" href="https://twitter.com/CylonJS">@CylonJS</a>
            </ul>
          </div>
        </div>
        <div class="side-column">
          <div class="categories">
            <h4>Tags</h4>
            <ul>
              <li><a href="/blog/tags/robots/">Robots</a></li>
              <li><a href="/blog/tags/events/">Events</a></li>
            </ul>
          </div>
          <div class="network">
            <h4>Network</h4>
            <div class="network-links">
              <a href="https://twitter.com/cylonjs"><img src="/images/elements/twitter.png"></a>
              <a href="https://github.com/hybridgroup/cylon"><img src="/images/elements/github.png"></a>
            </div>
          </div>
          <div class="titles">
            <h4>Posts</h4>
            <ul>
              <li><a href="/blog/2016/01/19/cylon-off-and-rolling-in-2016/">Cylon.js Off And Rolling In 2016</a></li>
              <li><a href="/blog/2015/09/08/cylon-1.2.0-logging-timing-ble/">Cylon.js 1.2.0 - Logging and Timing and BLE! Oh my!</a></li>
              <li><a href="/blog/2015/07/01/cylon-1.1.0-big-cleanup/">Cylon.js 1.1.0 - The Big Cleanup</a></li>
              <li><a href="/blog/2015/05/06/hello-node-bebop-drone/">Hello, Node Bebop Drone</a></li>
              <li><a href="/blog/2015/04/13/cylon-js-featured-in-wired/">Cylon.js featured in Wired</a></li>
              <li><a href="/blog/2015/04/08/cylon-1.0.0/">Cylon.js 1.0.0 is here!</a></li>
              <li><a href="/blog/2015/02/05/using-socketio-with-cylonjs-api/">Using Socket.io With The Cylon.js API</a></li>
              <li><a href="/blog/2015/01/14/cylon-0.22-0/">Cylon 0.22.0 - A New Year's Release</a></li>
              <li><a href="/blog/2014/11/28/cylon-0-21-0/">Cylon 0.21.0 is out!</a></li>
              <li><a href="/blog/2014/11/19/creating-multiplatform-precompiled-binaries-for-node-modules/">Creating Multiplatform Precompiled Binaries for Node.js Modules</a></li>
              <li><a href="/blog/2014/11/06/cylon-0-20-0/">Cylon 0.20.0 is out!</a></li>
              <li><a href="/blog/2014/11/05/run-cylon-js-from-your-browser/">Running Robots From Your Browser With Cylon.js</a></li>
              <li><a href="/blog/2014/11/03/winning-the-dreamforce-500-with-cylon-js/">Winning the Dreamforce 500 With Cylon.js</a></li>
              <li><a href="/blog/2014/10/01/with-the-new-cylon-js-you-can-be-fluent-too/">With The New Cylon.js 0.19.0, You Can Be Fluent Too</a></li>
              <li><a href="/blog/2014/09/17/cylon-js-on-intel-edison/">Cylon.js on Intel Edison</a></li>
              <li><a href="/blog/2014/08/07/cylon-takes-off-on-nodebots-day/">Cylon Takes Off on NodeBots Day</a></li>
              <li><a href="/blog/2014/07/29/cylon-js-fun-with-the-arduino-yun/">Cylon.js Fun With The Arduino Yun</a></li>
              <li><a href="/blog/2014/07/22/control-robots-from-your-pebble/">Control Robots From Your Pebble</a></li>
              <li><a href="/blog/2014/07/14/making-moves-with-intel-galileo/">Making Moves With Intel Galileo</a></li>
              <li><a href="/blog/2014/07/01/the-cylon-nest/">The Cylon Nest</a></li>
              <li><a href="/blog/2014/06/20/announcing-full-tessel-support/">Announcing Full Tessel Support!</a></li>
              <li><a href="/blog/2014/06/13/cylon-0-15-0/">Cylon 0.15.0 is Out!</a></li>
              <li><a href="/blog/2014/05/31/cylonjs-in-make-magazine/">Cylon.js in Make Magazine!</a></li>
              <li><a href="/blog/2014/05/29/cylonjs-at-jsconf-2014/">Cylon.js At JSConf 2014</a></li>
              <li><a href="/blog/2014/05/18/cylonjs-takes-the-stage-at-makerfaire/">Cylon.js Takes The Stage At MakerFaire</a></li>
              <li><a href="/blog/2014/05/10/cylons-in-scotland/">Cylon.js In Scotland</a></li>
              <li><a href="/blog/2014/05/07/robots-are-the-new-normal-at-nextberlin/">Robots Are The New Normal At NextBerlin</a></li>
              <li><a href="/blog/2014/05/03/thingscon-ich-bin-ein-cylon/">Thingscon - Ich Bin Ein Cylon</a></li>
              <li><a href="/blog/2014/04/12/national-robotics-week-at-the-robotics-society-of-southern-california/">National Robotics Week at the Robotics Society of Southern California</a></li>
              <li><a href="/blog/2014/04/02/functional-robots-with-wisp/">Functional Robots With Wisp</a></li>
              <li><a href="/blog/2014/03/28/release-0.12-is-for-robotops/">Release 0.12 Is For RobotOps</a></li>
              <li><a href="/blog/2014/03/24/making-waves-at-makerland/">Making Waves At Makerland</a></li>
              <li><a href="/blog/2014/03/04/this-one-goes-to-0.11-of-pure-javascript/">This One Goes To 0.11 Of Pure JavaScript</a></li>
              <li><a href="/blog/2014/02/24/tipping-scale12x/">Tipping SCaLE12X</a></li>
              <li><a href="/blog/2014/02/06/intro-robeaux-a-universal-user-interface-to-robotic-devices/">Intro Robeaux- A Universal User Interface To Robotic Devices</a></li>
              <li><a href="/blog/2014/01/21/ng-robots-a-fun-robot-hackathon-at-the-first-ng-conf/">ng-robots! A Fun Robot Hackathon At The First ng-conf</a></li>
              <li><a href="/blog/2014/01/15/number-9-the-release-in-which-we-add-a-web-ux-more-platforms-and-tools/">Number 9! The Release In Which We Add A Web UX, More Platforms, and Tools</a></li>
              <li><a href="/blog/2013/12/16/release-0.8.0-makes-10-platforms/">Release 0.8.0 Makes 10 Platforms</a></li>
              <li><a href="/blog/2013/12/12/robotsconf-was-remarkable/">RobotsConf Was Remarkable</a></li>
              <li><a href="/blog/2013/11/26/dreamforce-means-connected-devices-are-a-thing/">Dreamforce Means Connected Devices Are A Thing</a></li>
              <li><a href="/blog/2013/11/15/dreamforce-is-coming/">Dreamforce Is Coming!</a></li>
              <li><a href="/blog/2013/11/13/welcome-cylon-js/">Welcome, Cylon.js</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="app-footer">
      <div class="frameworks">
        <div class="parallax-container">
          <div class="background-footer parallax-bottom"></div>
          <div class="container">
            <div class="column-footer">
              <div class="img">
                <img class="display" src="/images/elements/logo-cylon-2x.png">
              </div>
              <h4>Multiple solutions</h4>
              <p>Cylon.js provides a simple, yet powerful way to create solutions that incorporate multiple, different hardware devices at the same time.</p>
            </div>
            <div class="column-footer">
              <div class="img">
                <img class="display" src="/images/elements/logo-artoo-2x.png">
              </div>
              <h4>Artoo</h4>
              <p>Want to use Ruby on robots? Check out our sister project Artoo</p>
              <div class="button-footer">
                <a target="blank" href="http://artoo.io">View Project</a>
              </div>
            </div>
            <div class="column-footer">
              <div class="img">
                <img class="display" src="/images/elements/logo-gobot-2x.png">
              </div>
              <h4>Gobot</h4>
              <p>Want to use the Go programming language to power your robots? Check out our sister project Gobot</p>
              <div class="button-footer">
                <a target="blank" href="http://gobot.io">View Project</a>
              </div>
            </div>
            <div class="clear"></div>
          </div>
        </div>
      </div>
      <div class="copyright">
        <div class="container">
          <div class="hybrid-group">
            <span>© Copyright 2012-2016</span>
            <a href="http://hybridgroup.com" id="THG-logo" target="_blank">
              <img alt="The Hybrid Group" src="/images/elements/THG_logo.png">
            </a>
          </div>
          <div class="top-link">
            <a href="#top">
              <img alt="Top" src="/images/elements/triangle_up.svg">
              <p>Top</p>
            </a>
          </div>
          <div class="clear"></div>
        </div>
      </div>
    </div>
  </body>
</html>
